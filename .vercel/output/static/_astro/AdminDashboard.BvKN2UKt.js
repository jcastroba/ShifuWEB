import{c as b,j as e,C as q,a as Z}from"./x.D2Z88nwF.js";import{r}from"./index.eCxJ45ll.js";import{S as ee}from"./ShiftDetailModal.BnxAMSFk.js";import{S as te}from"./save.D5HEFXpd.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],re=b("Bell",se);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]],le=b("CirclePlay",ae);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],oe=b("CircleX",ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],E=b("LoaderCircle",de);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ie=b("RefreshCw",ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],me=b("Send",xe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],he=b("Settings",ue);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ge=b("User",be);function pe({serverId:c}){const[d,y]=r.useState(!1),[p,x]=r.useState(!1),[S,u]=r.useState(!1),[C,h]=r.useState(!1),[T,o]=r.useState(""),[f,j]=r.useState(!1),[N,g]=r.useState(null),[_,k]=r.useState(null),[n,i]=r.useState({alertShiftStart:!0,alertShiftEnd:!0,alertBreakExceeded:!0,alertMissedSchedule:!0,maxBreakMinutes:15,scheduleGraceMinutes:10});r.useEffect(()=>{c&&$()},[c]);const $=()=>{y(!0),fetch(`/api/admin/telegram-settings?serverId=${c}`).then(s=>s.json()).then(s=>{s.server_id&&(j(s.has_token),g(s.telegram_chat_id),k(s.verification_code),i({alertShiftStart:s.alert_shift_start,alertShiftEnd:s.alert_shift_end,alertBreakExceeded:s.alert_break_exceeded,alertMissedSchedule:s.alert_missed_schedule,maxBreakMinutes:s.max_break_minutes,scheduleGraceMinutes:s.schedule_grace_minutes})),y(!1)}).catch(s=>{console.error(s),y(!1)})},A=()=>{x(!0),fetch("/api/admin/telegram-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serverId:c,telegramBotToken:T,...n})}).then(s=>s.json()).then(s=>{s.success&&(k(s.verificationCode),j(!0),o("")),x(!1)}).catch(s=>{console.error(s),x(!1)})},I=()=>{u(!0),fetch("/api/admin/telegram-check-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serverId:c})}).then(s=>s.json()).then(s=>{s.linked?(g(s.chatId),k(null)):alert("Aún no se detecta el mensaje en el grupo. Asegúrate de haber enviado el código."),u(!1)}).catch(s=>{console.error(s),u(!1)})},O=()=>{h(!0),fetch("/api/admin/telegram-test-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serverId:c})}).then(s=>s.json()).then(s=>{s.success?alert("Mensaje enviado correctamente. Revisa tu grupo de Telegram."):alert("Error al enviar mensaje: "+(s.error||"Desconocido")),h(!1)}).catch(s=>{console.error(s),alert("Error de conexión"),h(!1)})};return d?e.jsx("div",{className:"p-10 text-center",children:e.jsx(E,{className:"animate-spin mx-auto text-primary"})}):e.jsxs("div",{className:"bg-surface dark:bg-secondary-dark p-6 rounded-xl shadow-lg border border-border-color space-y-8 transition-colors duration-300",children:[e.jsxs("div",{className:"border-b border-border-color pb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-text-main flex items-center gap-2",children:[e.jsx(me,{className:"text-blue-500"})," Notificaciones de Telegram"]}),e.jsx("p",{className:"text-text-muted text-sm mt-1",children:"Configura alertas automáticas para tu equipo."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-lg text-text-main",children:"1. Configuración del Bot"}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg text-sm text-blue-800 dark:text-blue-300",children:[e.jsxs("p",{children:["1. Crea un bot en Telegram con ",e.jsx("a",{href:"https://telegram.me/BotFather",target:"_blank",rel:"noopener noreferrer",className:"font-bold underline hover:text-blue-600 dark:hover:text-blue-400",children:"@BotFather"}),"."]}),e.jsxs("p",{children:["2. Copia el ",e.jsx("strong",{children:"Token"})," y pégalo aquí."]}),e.jsx("p",{children:"3. Agrega tu bot al grupo donde quieres recibir las alertas."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Bot Token"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{type:"password",placeholder:f?"Token guardado (escribe para cambiar)":"Pegar token aquí...",value:T,onChange:s=>o(s.target.value),className:"flex-1 p-2 border rounded-lg bg-background dark:bg-gray-800 text-text-main border-border-color focus:ring-2 focus:ring-blue-500 outline-none"})})]})]}),f&&!N&&e.jsxs("div",{className:"space-y-4 border-t border-border-color pt-6",children:[e.jsx("h3",{className:"font-bold text-lg text-text-main",children:"2. Vincular Grupo"}),_?e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 p-6 rounded-xl text-center space-y-4",children:[e.jsx("p",{className:"text-yellow-800 dark:text-yellow-300 font-medium",children:"Envía este mensaje a tu grupo de Telegram:"}),e.jsxs("div",{className:"text-3xl font-mono font-bold text-text-main bg-surface dark:bg-gray-800 p-4 rounded-lg border border-border-color inline-block select-all",children:["/start ",_]}),e.jsx("p",{className:"text-xs text-text-muted",children:"El bot debe estar en el grupo para leer el mensaje."}),e.jsxs("button",{onClick:I,disabled:S,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 mx-auto",children:[S?e.jsx(E,{className:"animate-spin w-4 h-4"}):e.jsx(ie,{className:"w-4 h-4"}),"Verificar Vinculación"]})]}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-text-muted mb-4",children:"Guarda la configuración para generar un código de vinculación."})})]}),N&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 p-4 rounded-lg flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"text-green-600 dark:text-green-400 w-6 h-6"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-green-800 dark:text-green-300",children:"¡Grupo Vinculado Correctamente!"}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400",children:["Chat ID: ",N]})]})]}),e.jsxs("button",{onClick:O,disabled:C,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2 text-sm",children:[C?e.jsx(E,{className:"animate-spin w-4 h-4"}):e.jsx(re,{className:"w-4 h-4"}),"Probar Alerta"]})]}),e.jsxs("div",{className:"space-y-4 border-t border-border-color pt-6",children:[e.jsx("h3",{className:"font-bold text-lg text-text-main",children:"3. Preferencias de Alerta"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-border-color rounded-lg hover:bg-secondary/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.alertShiftStart,onChange:s=>i({...n,alertShiftStart:s.target.checked}),className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("span",{className:"text-text-main",children:"Inicio de Turno"})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-border-color rounded-lg hover:bg-secondary/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.alertShiftEnd,onChange:s=>i({...n,alertShiftEnd:s.target.checked}),className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("span",{className:"text-text-main",children:"Fin de Turno"})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-border-color rounded-lg hover:bg-secondary/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.alertBreakExceeded,onChange:s=>i({...n,alertBreakExceeded:s.target.checked}),className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("span",{className:"text-text-main",children:"Exceso de Break"})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-border-color rounded-lg hover:bg-secondary/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.alertMissedSchedule,onChange:s=>i({...n,alertMissedSchedule:s.target.checked}),className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("span",{className:"text-text-main",children:"Falta Injustificada"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Límite de Break (minutos)"}),e.jsx("input",{type:"number",value:n.maxBreakMinutes,onChange:s=>i({...n,maxBreakMinutes:parseInt(s.target.value)}),className:"w-full p-2 border rounded-lg bg-background dark:bg-gray-800 text-text-main border-border-color"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Tolerancia de Retardo (minutos)"}),e.jsx("input",{type:"number",value:n.scheduleGraceMinutes,onChange:s=>i({...n,scheduleGraceMinutes:parseInt(s.target.value)}),className:"w-full p-2 border rounded-lg bg-background dark:bg-gray-800 text-text-main border-border-color"})]})]})]}),e.jsx("div",{className:"pt-6",children:e.jsxs("button",{onClick:A,disabled:p,className:"w-full bg-primary-dark text-white py-3 rounded-xl font-bold hover:bg-primary-dark/90 transition-colors flex justify-center items-center gap-2",children:[p?e.jsx(E,{className:"animate-spin"}):e.jsx(te,{}),"Guardar Configuración"]})})]})}function Ne({adminServers:c}){const[d,y]=r.useState(c.length>0?String(c[0].id):""),p=c.find(t=>String(t.id)===d),[x,S]=r.useState("week"),[u,C]=r.useState(""),[h,T]=r.useState(""),[o,f]=r.useState([]),[j,N]=r.useState(""),[g,_]=r.useState(null),[k,n]=r.useState([]),[i,$]=r.useState([]),[A,I]=r.useState([]),[O,s]=r.useState(!1),[J,F]=r.useState(null),[H,R]=r.useState(!1),[m,M]=r.useState(null),[z,U]=r.useState(""),[P,Q]=r.useState(Date.now());r.useEffect(()=>{const t=setInterval(()=>Q(Date.now()),1e3);return()=>clearInterval(t)},[]);const G=()=>{if(!d)return;s(!0);let t=new Date,l=new Date;if(x==="custom")u&&(t=new Date(u)),h&&(l=new Date(h)),l.setHours(23,59,59,999);else{const a=new Date;switch(x){case"week":const D=a.getDay()||7;D!==1?a.setHours(-24*(D-1)):a.setHours(0,0,0,0),t=a;break;case"fortnight":a.setDate(a.getDate()-15),t=a;break;case"month":a.setDate(1),t=a;break;case"year":a.setMonth(0,1),t=a;break}}const v=o.length>0?`&userIds=${o.join(",")}`:"",w=`&startDate=${t.toISOString()}&endDate=${l.toISOString()}`;fetch(`/api/admin/dashboard-stats?serverId=${d}${w}${v}`).then(a=>a.json()).then(a=>{_(a.stats),n(a.history),I(a.users),s(!1)}).catch(a=>{console.error(a),s(!1)}),V()},V=()=>{d&&fetch(`/api/admin/active-shifts?serverId=${d}`).then(t=>t.json()).then(t=>$(t)).catch(console.error)};r.useEffect(()=>{G();const t=setInterval(V,3e4);return()=>clearInterval(t)},[d,x,u,h,o]);const X=async()=>{if(!(!m||!d))try{(await fetch("/api/admin/actions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:m.type,shiftId:m.type==="close_shift"?m.id:void 0,breakId:m.type==="end_break"?m.id:void 0,serverId:d,observation:z})})).ok?(M(null),U(""),G()):alert("Error al ejecutar acción")}catch(t){console.error(t)}},B=t=>{const l=Math.floor(t/1e3),v=Math.floor(l/3600),w=Math.floor(l%3600/60),a=l%60;return`${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},K=A.filter(t=>t.nickname.toLowerCase().includes(j.toLowerCase())||t.username.toLowerCase().includes(j.toLowerCase())),W=t=>{o.includes(t)?f(o.filter(l=>l!==t)):f([...o,t])},[L,Y]=r.useState(!1);return e.jsxs("div",{className:"font-roboto space-y-6",children:[e.jsxs("div",{className:"bg-surface dark:bg-secondary-dark p-4 rounded-xl shadow-md border-l-4 border-primary-dark flex flex-col lg:flex-row gap-4 justify-between items-start lg:items-center transition-colors duration-300",children:[e.jsxs("div",{className:"w-full lg:w-auto flex items-center gap-3",children:[p?.icon_url&&e.jsx("img",{src:p.icon_url,alt:p.name,className:"w-12 h-12 rounded-full border border-border-color shadow-sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-bold text-text-muted uppercase mb-1",children:"Servidor"}),e.jsx("select",{value:d,onChange:t=>y(t.target.value),className:"w-full p-2 border rounded-lg bg-background dark:bg-gray-800 font-bold text-text-main border-border-color focus:ring-2 focus:ring-primary outline-none",children:c.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsx("button",{onClick:()=>Y(!L),className:`p-2 rounded-lg border transition-colors ${L?"bg-blue-100 dark:bg-blue-900/30 border-blue-300 text-blue-700 dark:text-blue-400":"bg-background dark:bg-gray-800 border-border-color text-text-muted hover:bg-secondary/10"}`,title:"Configurar Notificaciones",children:e.jsx(he,{size:20})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-end w-full lg:w-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-text-muted uppercase mb-1",children:"Rango"}),e.jsxs("select",{value:x,onChange:t=>S(t.target.value),className:"p-2 border rounded-lg bg-background dark:bg-gray-800 text-text-main border-border-color text-sm",children:[e.jsx("option",{value:"week",children:"Semana"}),e.jsx("option",{value:"fortnight",children:"Quincena"}),e.jsx("option",{value:"month",children:"Mes"}),e.jsx("option",{value:"year",children:"Año"}),e.jsx("option",{value:"custom",children:"Personalizado"})]})]}),x==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-text-muted uppercase mb-1",children:"Inicio"}),e.jsx("input",{type:"date",value:u,onChange:t=>C(t.target.value),className:"p-2 border rounded-lg bg-background dark:bg-gray-800 text-text-main border-border-color text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-text-muted uppercase mb-1",children:"Fin"}),e.jsx("input",{type:"date",value:h,onChange:t=>T(t.target.value),className:"p-2 border rounded-lg bg-background dark:bg-gray-800 text-text-main border-border-color text-sm"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>R(!H),className:"p-2 border rounded-lg bg-background dark:bg-gray-800 text-text-main border-border-color text-sm flex items-center gap-2 hover:bg-secondary/10",children:[e.jsx(ge,{size:16}),o.length===0?"Todos los usuarios":`${o.length} seleccionados`]}),H&&e.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-surface dark:bg-secondary-dark border border-border-color rounded-lg shadow-xl z-50 p-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("input",{type:"text",placeholder:"Buscar usuario...",className:"w-full p-2 border rounded text-sm bg-background dark:bg-gray-800 text-text-main border-border-color",value:j,onChange:t=>N(t.target.value)}),e.jsx("button",{onClick:()=>R(!1),className:"ml-2 text-text-muted hover:text-text-main",children:e.jsx(oe,{size:16})})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-1",children:K.map(t=>e.jsxs("div",{onClick:()=>W(t.id),className:"flex items-center gap-2 p-1 hover:bg-secondary/10 cursor-pointer rounded text-text-main",children:[e.jsx("div",{className:`w-4 h-4 border rounded flex items-center justify-center ${o.includes(t.id)?"bg-primary border-primary":"border-border-color"}`,children:o.includes(t.id)&&e.jsx(q,{size:12,className:"text-white"})}),e.jsx("span",{className:"text-sm truncate",children:t.nickname})]},t.id))}),o.length>0&&e.jsx("button",{onClick:()=>f([]),className:"w-full mt-2 text-xs text-red-500 hover:underline text-center",children:"Limpiar filtros"})]})]})]})]}),L&&d&&e.jsx(pe,{serverId:d}),g&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-surface dark:bg-secondary-dark p-4 rounded-xl shadow border-t-4 border-green-500 transition-colors duration-300",children:[e.jsx("p",{className:"text-text-muted text-xs font-bold uppercase",children:"Total Horas Trabajadas"}),e.jsxs("h3",{className:"text-2xl font-bold text-text-main",children:[g.totalWorkedHours.toFixed(2),"h"]})]}),e.jsxs("div",{className:"bg-surface dark:bg-secondary-dark p-4 rounded-xl shadow border-t-4 border-yellow-500 transition-colors duration-300",children:[e.jsx("p",{className:"text-text-muted text-xs font-bold uppercase",children:"Total Horas Break"}),e.jsxs("h3",{className:"text-2xl font-bold text-text-main",children:[g.totalBreakHours.toFixed(2),"h"]})]}),e.jsxs("div",{className:"bg-surface dark:bg-secondary-dark p-4 rounded-xl shadow border-t-4 border-blue-500 transition-colors duration-300",children:[e.jsx("p",{className:"text-text-muted text-xs font-bold uppercase",children:"Turnos Totales"}),e.jsx("h3",{className:"text-2xl font-bold text-text-main",children:g.totalShifts})]}),e.jsxs("div",{className:"bg-surface dark:bg-secondary-dark p-4 rounded-xl shadow border-t-4 border-purple-500 transition-colors duration-300",children:[e.jsx("p",{className:"text-text-muted text-xs font-bold uppercase",children:"Horas Extras (Total)"}),e.jsx("h3",{className:"text-2xl font-bold text-text-main",children:"-"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Ver detalle por usuario"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs("h3",{className:"text-xl font-lilita text-secondary-dark dark:text-primary flex items-center gap-2",children:[e.jsx(le,{className:"text-green-500"})," Turnos Activos"]}),i.length===0?e.jsx("div",{className:"bg-surface dark:bg-secondary-dark p-6 rounded-xl shadow text-center text-text-muted transition-colors duration-300",children:"No hay usuarios trabajando en este momento."}):i.map(t=>{const l=!!t.active_break,v=new Date(t.start_time).getTime(),w=l?new Date(t.active_break.break_start).getTime():0,a=Math.max(0,P-v),D=l?Math.max(0,P-w):0;return e.jsxs("div",{className:`bg-surface dark:bg-secondary-dark p-4 rounded-xl shadow border-l-4 ${l?"border-yellow-400":"border-green-500"} transition-colors duration-300`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-text-main",children:t.nickname}),e.jsxs("p",{className:"text-xs text-text-muted",children:["@",t.username]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${l?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}`,children:l?"EN BREAK":"TRABAJANDO"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-text-muted text-xs",children:"Tiempo Total"}),e.jsx("p",{className:"font-mono font-bold text-lg text-text-main",children:B(a)})]}),l&&e.jsxs("div",{className:"text-sm text-right",children:[e.jsx("p",{className:"text-text-muted text-xs",children:"Tiempo Break"}),e.jsx("p",{className:"font-mono font-bold text-lg text-yellow-600 dark:text-yellow-400",children:B(D)})]})]}),l&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded text-xs text-yellow-800 dark:text-yellow-300 mb-3 italic",children:["Razón: ",t.active_break.reason]}),e.jsx("div",{className:"flex gap-2",children:l?e.jsx("button",{onClick:()=>M({type:"end_break",id:t.active_break.id,name:t.nickname}),className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-1 px-2 rounded text-xs font-bold transition-colors",children:"Finalizar Break"}):e.jsx("button",{onClick:()=>M({type:"close_shift",id:t.id,name:t.nickname}),className:"flex-1 bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded text-xs font-bold transition-colors",children:"Cerrar Turno"})})]},t.id)})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("h3",{className:"text-xl font-lilita text-secondary-dark dark:text-primary mb-4 flex items-center gap-2",children:[e.jsx(Z,{className:"text-primary"})," Historial de Turnos"]}),e.jsx("div",{className:"bg-surface dark:bg-secondary-dark rounded-xl shadow overflow-hidden transition-colors duration-300",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border-color",children:[e.jsx("thead",{className:"bg-secondary-dark text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Duración"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Break"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Estado"})]})}),e.jsx("tbody",{className:"bg-surface dark:bg-secondary-dark divide-y divide-border-color",children:k.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-4 text-center text-text-muted",children:"No hay registros en este periodo."})}):k.map(t=>e.jsxs("tr",{onClick:()=>F(t),className:"hover:bg-secondary/10 transition-colors cursor-pointer",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.avatar_url||"https://cdn.discordapp.com/embed/avatars/0.png",alt:t.nickname,className:"w-8 h-8 rounded-full border border-border-color"}),e.jsx("div",{className:"text-sm font-medium text-text-main",children:t.nickname})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-text-muted",children:[new Date(t.start_time).toLocaleDateString()," ",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:new Date(t.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-bold text-green-600 dark:text-green-400",children:B(t.durationMs)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-yellow-600 dark:text-yellow-400",children:B(t.breakMs)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.end_time?e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200",children:"Finalizado"}):e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 animate-pulse",children:"Activo"})})]},t.id))})]})})})]})]}),e.jsx(ee,{shift:J,onClose:()=>F(null)}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface dark:bg-secondary-dark rounded-xl shadow-2xl max-w-md w-full p-6 border border-border-color",children:[e.jsx("h3",{className:"text-xl font-bold mb-2 text-text-main",children:m.type==="close_shift"?"Cerrar Turno Forzosamente":"Finalizar Break Forzosamente"}),e.jsxs("p",{className:"text-text-muted mb-4",children:["Estás a punto de modificar el estado de ",e.jsx("strong",{children:m.name}),"."]}),e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"Observación (Obligatorio)"}),e.jsx("textarea",{className:"w-full border rounded-lg p-2 mb-4 bg-background dark:bg-gray-800 text-text-main border-border-color focus:ring-2 focus:ring-primary outline-none",rows:3,placeholder:"Motivo del cierre...",value:z,onChange:t=>U(t.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>M(null),className:"px-4 py-2 text-text-muted hover:bg-secondary/10 rounded-lg",children:"Cancelar"}),e.jsx("button",{onClick:X,disabled:!z.trim(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Confirmar Acción"})]})]})})]})}export{Ne as default};
