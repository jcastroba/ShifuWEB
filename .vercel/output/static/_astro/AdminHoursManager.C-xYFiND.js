import{c as A,j as e,b as D,a as R,C as U,X as S}from"./x.D2Z88nwF.js";import{r as a}from"./index.eCxJ45ll.js";import{S as z}from"./save.D5HEFXpd.js";import{C as M}from"./circle-alert.DrELhO_B.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],C=A("DollarSign",$),_=[{id:1,name:"Lunes"},{id:2,name:"Martes"},{id:3,name:"Miércoles"},{id:4,name:"Jueves"},{id:5,name:"Viernes"},{id:6,name:"Sábado"},{id:7,name:"Domingo"}];function G({serverId:m,userId:d,onSave:v}){const[o,j]=a.useState("09:00"),[c,u]=a.useState("17:00"),[l,b]=a.useState([]),[x,p]=a.useState(!1),[h,g]=a.useState(!1),[i,f]=a.useState(!1),[y,N]=a.useState(0);a.useEffect(()=>{d&&m&&t()},[d,m]),a.useEffect(()=>{T()},[o,c,l]);const t=async()=>{g(!0);try{const n=await(await fetch(`/api/admin/schedules?serverId=${m}&userId=${d}`)).json();if(Array.isArray(n)&&n.length>0){const s=n.find(k=>!k.is_rest_day);s&&(j(s.start_time?s.start_time.slice(0,5):"09:00"),u(s.end_time?s.end_time.slice(0,5):"17:00"));const w=n.filter(k=>k.is_rest_day).map(k=>k.day_of_week);b(w)}}catch(r){console.error(r)}finally{g(!1)}},T=()=>{if(!o||!c){N(0);return}const r=new Date(`1970-01-01T${o}`);let s=(new Date(`1970-01-01T${c}`).getTime()-r.getTime())/(1e3*60*60);s<0&&(s=0);const w=7-l.length;N(s*w)},E=r=>{l.includes(r)?b(l.filter(n=>n!==r)):b([...l,r])},H=async()=>{f(!0);try{const r=_.map(s=>({day_of_week:s.id,start_time:o,end_time:c,is_rest_day:l.includes(s.id)})),n=await fetch("/api/admin/schedules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serverId:m,targetUserId:d,schedule:r,applyProRating:x})});if(n.ok){const s=await n.json();N(s.totalHours),v&&v(),alert("Horario guardado correctamente")}else alert("Error al guardar horario")}catch(r){console.error(r),alert("Error de conexión")}finally{f(!1)}};return h?e.jsx("div",{className:"p-4 text-center text-text-main",children:"Cargando horario..."}):e.jsxs("div",{className:"bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg font-roboto border border-border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-lilita text-secondary-dark dark:text-white flex items-center gap-2",children:[e.jsx(D,{className:"text-primary"})," Configuración de Horario"]}),e.jsxs("div",{className:"bg-primary/10 px-4 py-2 rounded-lg border border-primary/20",children:[e.jsx("span",{className:"text-sm text-primary font-bold uppercase",children:"Total Semanal"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-dark dark:text-primary",children:[y.toFixed(1),"h"]})]})]}),e.jsxs("div",{className:"bg-background p-4 rounded-lg border border-border mb-6 flex flex-col md:flex-row gap-6 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"text-primary"}),e.jsx("span",{className:"font-bold text-text-main",children:"Horario General:"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Entrada"}),e.jsx("input",{type:"time",value:o,onChange:r=>j(r.target.value),className:"border border-border bg-white dark:bg-secondary-dark text-text-main rounded-lg p-2 font-mono focus:ring-primary focus:border-primary"})]}),e.jsx("span",{className:"text-text-muted mt-4",children:"-"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Salida"}),e.jsx("input",{type:"time",value:c,onChange:r=>u(r.target.value),className:"border border-border bg-white dark:bg-secondary-dark text-text-main rounded-lg p-2 font-mono focus:ring-primary focus:border-primary"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold text-text-main mb-3",children:"Selecciona los días de descanso:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:_.map(r=>{const n=l.includes(r.id);return e.jsxs("div",{onClick:()=>E(r.id),className:`
                            cursor-pointer p-3 rounded-lg border transition-all flex items-center justify-between
                            ${n?"bg-green-100 dark:bg-green-900/30 border-green-300 dark:border-green-700 text-green-800 dark:text-green-300 shadow-sm":"bg-white dark:bg-secondary-dark border-border text-text-muted hover:bg-background"}
                        `,children:[e.jsx("span",{className:"font-bold",children:r.name}),n&&e.jsx(U,{size:16})]},r.id)})})]}),e.jsx("div",{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"proRating",checked:x,onChange:r=>p(r.target.checked),className:"w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary cursor-pointer"}),e.jsxs("label",{htmlFor:"proRating",className:"text-sm text-text-main font-medium cursor-pointer select-none",children:["Aplicar prorrateo (inicio a mitad de semana)",e.jsx("p",{className:"text-xs text-text-muted font-normal mt-1",children:"Si se marca, se restarán de la deuda las horas correspondientes a los días de esta semana que ya han pasado."})]})]})}),e.jsx("div",{className:"mt-8 flex justify-end border-t border-border pt-4",children:e.jsxs("button",{onClick:H,disabled:i,className:"flex items-center gap-2 bg-primary text-white px-8 py-3 rounded-lg hover:bg-primary-dark transition-colors font-bold disabled:opacity-50 shadow-lg",children:[e.jsx(z,{size:20}),i?"Guardando...":"Guardar Configuración"]})})]})}function q({adminServers:m}){const[d,v]=a.useState(""),[o,j]=a.useState([]),[c,u]=a.useState(!1),[l,b]=a.useState(null),[x,p]=a.useState(null),[h,g]=a.useState(""),[i,f]=a.useState("partial"),y=()=>{if(!d){j([]);return}u(!0),fetch(`/api/server-users?serverId=${d}`).then(t=>t.json()).then(t=>{j(t),u(!1)}).catch(t=>{console.error(t),u(!1)})};a.useEffect(()=>{y()},[d]);const N=async()=>{if(!(!x||!d))try{(await fetch("/api/admin/reduce-debt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serverId:d,targetUserId:x.id,amount:i==="partial"?parseFloat(h):0,type:i})})).ok?(p(null),g(""),y()):alert("Error al reducir deuda")}catch(t){console.error(t),alert("Error de conexión")}};return m.length===0?null:e.jsxs("div",{className:"bg-white dark:bg-secondary-dark p-6 rounded-lg shadow-md mt-6 font-roboto border border-border",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h2",{className:"text-2xl font-lilita text-secondary-dark dark:text-white",children:"Gestión de Usuarios"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"Seleccionar Servidor"}),e.jsxs("select",{className:"block w-full md:w-1/3 pl-3 pr-10 py-2 text-base bg-background text-text-main border-border focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md border",value:d,onChange:t=>v(t.target.value),children:[e.jsx("option",{value:"",children:"Seleccione un servidor..."}),m.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),c&&e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"})}),!c&&o.length>0&&e.jsx("div",{className:"overflow-x-auto bg-background rounded-lg border border-border",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-secondary-dark text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Usuario"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Horas Semanales"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Deuda"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-secondary-dark divide-y divide-border",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-background transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-text-main",children:t.nickname||t.username}),e.jsxs("div",{className:"text-sm text-text-muted",children:["@",t.username]})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-center bg-background rounded-lg p-2 w-24 border border-border",children:[e.jsx("span",{className:"font-bold text-text-main text-lg",children:t.weekly_hours||0}),e.jsx("span",{className:"ml-1 text-text-muted text-xs",children:"hrs"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:`flex items-center justify-center rounded-lg p-2 w-24 border border-border ${Number(t.accumulated_debt)>0?"bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400":"bg-background text-text-main"}`,children:[e.jsx("span",{className:"font-bold text-lg",children:Number(t.accumulated_debt||0).toFixed(1)}),e.jsx("span",{className:"ml-1 text-xs",children:"hrs"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b(t),className:"flex items-center gap-1 text-primary hover:text-primary-dark font-bold text-sm bg-primary/10 px-3 py-1 rounded-lg transition-colors",children:[e.jsx(D,{size:16}),"Gestionar Horario"]}),Number(t.accumulated_debt)>0&&e.jsxs("button",{onClick:()=>{p(t),f("partial"),g("")},className:"flex items-center gap-1 text-red-600 hover:text-red-700 font-bold text-sm bg-red-100 px-3 py-1 rounded-lg transition-colors",children:[e.jsx(C,{size:16}),"Reducir Deuda"]})]})})]},t.id))})]})}),!c&&d&&o.length===0&&e.jsx("p",{className:"text-center text-text-muted py-10",children:"No se encontraron usuarios en este servidor."}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-secondary-dark rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto relative border border-border",children:[e.jsx("button",{onClick:()=>b(null),className:"absolute top-4 right-4 text-text-muted hover:text-text-main transition-colors",children:e.jsx(S,{size:24})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 text-text-main",children:["Horario de ",l.nickname]}),e.jsx(G,{serverId:d,userId:l.id,onSave:()=>{y()}})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-secondary-dark rounded-xl shadow-2xl max-w-md w-full relative border border-border p-6",children:[e.jsx("button",{onClick:()=>p(null),className:"absolute top-4 right-4 text-text-muted hover:text-text-main transition-colors",children:e.jsx(S,{size:24})}),e.jsxs("h3",{className:"text-xl font-bold mb-4 text-text-main flex items-center gap-2",children:[e.jsx(C,{className:"text-red-500"}),"Reducir Deuda"]}),e.jsxs("p",{className:"text-text-muted mb-4",children:["Usuario: ",e.jsx("span",{className:"font-bold text-text-main",children:x.nickname}),e.jsx("br",{}),"Deuda Actual: ",e.jsxs("span",{className:"font-bold text-red-500",children:[x.accumulated_debt," hrs"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>f("partial"),className:`flex-1 py-2 rounded-lg border ${i==="partial"?"bg-primary text-white border-primary":"bg-background text-text-main border-border"}`,children:"Parcial"}),e.jsx("button",{onClick:()=>f("total"),className:`flex-1 py-2 rounded-lg border ${i==="total"?"bg-primary text-white border-primary":"bg-background text-text-main border-border"}`,children:"Total"})]}),i==="partial"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-1",children:"Cantidad a reducir (horas)"}),e.jsx("input",{type:"number",value:h,onChange:t=>g(t.target.value),className:"w-full p-2 bg-background border border-border rounded-lg text-text-main focus:ring-primary focus:border-primary",placeholder:"Ej: 5",min:"0",max:x.accumulated_debt})]}),i==="total"&&e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 p-3 rounded-lg flex items-start gap-2 text-yellow-700 dark:text-yellow-400 text-sm",children:[e.jsx(M,{size:16,className:"mt-0.5 flex-shrink-0"}),e.jsx("p",{children:"Se eliminará toda la deuda acumulada de este usuario."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{onClick:()=>p(null),className:"px-4 py-2 text-text-muted hover:text-text-main transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg transition-colors font-bold",disabled:i==="partial"&&(!h||parseFloat(h)<=0),children:"Confirmar"})]})]})]})})]})}export{q as default};
