import{j as e,b as v,a as D,C as E,X as H}from"./x.D2Z88nwF.js";import{r as n}from"./index.eCxJ45ll.js";import{S as T}from"./save.D5HEFXpd.js";const N=[{id:1,name:"Lunes"},{id:2,name:"Martes"},{id:3,name:"Miércoles"},{id:4,name:"Jueves"},{id:5,name:"Viernes"},{id:6,name:"Sábado"},{id:7,name:"Domingo"}];function G({serverId:c,userId:i,onSave:h}){const[l,u]=n.useState("09:00"),[o,m]=n.useState("17:00"),[d,x]=n.useState([]),[f,t]=n.useState(!1),[j,y]=n.useState(!1),[w,p]=n.useState(0);n.useEffect(()=>{i&&c&&k()},[i,c]),n.useEffect(()=>{S()},[l,o,d]);const k=async()=>{t(!0);try{const a=await(await fetch(`/api/admin/schedules?serverId=${c}&userId=${i}`)).json();if(Array.isArray(a)&&a.length>0){const r=a.find(b=>!b.is_rest_day);r&&(u(r.start_time?r.start_time.slice(0,5):"09:00"),m(r.end_time?r.end_time.slice(0,5):"17:00"));const g=a.filter(b=>b.is_rest_day).map(b=>b.day_of_week);x(g)}}catch(s){console.error(s)}finally{t(!1)}},S=()=>{if(!l||!o){p(0);return}const s=new Date(`1970-01-01T${l}`);let r=(new Date(`1970-01-01T${o}`).getTime()-s.getTime())/(1e3*60*60);r<0&&(r=0);const g=7-d.length;p(r*g)},C=s=>{d.includes(s)?x(d.filter(a=>a!==s)):x([...d,s])},_=async()=>{y(!0);try{const s=N.map(r=>({day_of_week:r.id,start_time:l,end_time:o,is_rest_day:d.includes(r.id)})),a=await fetch("/api/admin/schedules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({serverId:c,targetUserId:i,schedule:s})});if(a.ok){const r=await a.json();p(r.totalHours),h&&h(),alert("Horario guardado correctamente")}else alert("Error al guardar horario")}catch(s){console.error(s),alert("Error de conexión")}finally{y(!1)}};return f?e.jsx("div",{className:"p-4 text-center text-text-main",children:"Cargando horario..."}):e.jsxs("div",{className:"bg-surface p-6 rounded-xl shadow-lg font-roboto border border-border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-lilita text-secondary-dark dark:text-white flex items-center gap-2",children:[e.jsx(v,{className:"text-primary"})," Configuración de Horario"]}),e.jsxs("div",{className:"bg-primary/10 px-4 py-2 rounded-lg border border-primary/20",children:[e.jsx("span",{className:"text-sm text-primary font-bold uppercase",children:"Total Semanal"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-dark dark:text-primary",children:[w.toFixed(1),"h"]})]})]}),e.jsxs("div",{className:"bg-background p-4 rounded-lg border border-border mb-6 flex flex-col md:flex-row gap-6 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"text-primary"}),e.jsx("span",{className:"font-bold text-text-main",children:"Horario General:"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Entrada"}),e.jsx("input",{type:"time",value:l,onChange:s=>u(s.target.value),className:"border border-border bg-surface text-text-main rounded-lg p-2 font-mono focus:ring-primary focus:border-primary"})]}),e.jsx("span",{className:"text-text-muted mt-4",children:"-"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Salida"}),e.jsx("input",{type:"time",value:o,onChange:s=>m(s.target.value),className:"border border-border bg-surface text-text-main rounded-lg p-2 font-mono focus:ring-primary focus:border-primary"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-bold text-text-main mb-3",children:"Selecciona los días de descanso:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:N.map(s=>{const a=d.includes(s.id);return e.jsxs("div",{onClick:()=>C(s.id),className:`
                            cursor-pointer p-3 rounded-lg border transition-all flex items-center justify-between
                            ${a?"bg-green-100 dark:bg-green-900/30 border-green-300 dark:border-green-700 text-green-800 dark:text-green-300 shadow-sm":"bg-surface border-border text-text-muted hover:bg-background"}
                        `,children:[e.jsx("span",{className:"font-bold",children:s.name}),a&&e.jsx(E,{size:16})]},s.id)})})]}),e.jsx("div",{className:"mt-8 flex justify-end border-t border-border pt-4",children:e.jsxs("button",{onClick:_,disabled:j,className:"flex items-center gap-2 bg-primary text-white px-8 py-3 rounded-lg hover:bg-primary-dark transition-colors font-bold disabled:opacity-50 shadow-lg",children:[e.jsx(T,{size:20}),j?"Guardando...":"Guardar Configuración"]})})]})}function z({adminServers:c}){const[i,h]=n.useState(""),[l,u]=n.useState([]),[o,m]=n.useState(!1),[d,x]=n.useState(null),f=()=>{if(!i){u([]);return}m(!0),fetch(`/api/server-users?serverId=${i}`).then(t=>t.json()).then(t=>{u(t),m(!1)}).catch(t=>{console.error(t),m(!1)})};return n.useEffect(()=>{f()},[i]),c.length===0?null:e.jsxs("div",{className:"bg-surface p-6 rounded-lg shadow-md mt-6 font-roboto border border-border",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h2",{className:"text-2xl font-lilita text-secondary-dark dark:text-white",children:"Gestión de Usuarios"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"Seleccionar Servidor"}),e.jsxs("select",{className:"block w-full md:w-1/3 pl-3 pr-10 py-2 text-base bg-background text-text-main border-border focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md border",value:i,onChange:t=>h(t.target.value),children:[e.jsx("option",{value:"",children:"Seleccione un servidor..."}),c.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),o&&e.jsx("div",{className:"flex justify-center py-10",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"})}),!o&&l.length>0&&e.jsx("div",{className:"overflow-x-auto bg-background rounded-lg border border-border",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-secondary-dark text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Usuario"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Horas Semanales"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-border",children:l.map(t=>e.jsxs("tr",{className:"hover:bg-background transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-text-main",children:t.nickname||t.username}),e.jsxs("div",{className:"text-sm text-text-muted",children:["@",t.username]})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-center bg-background rounded-lg p-2 w-24 border border-border",children:[e.jsx("span",{className:"font-bold text-text-main text-lg",children:t.weekly_hours||0}),e.jsx("span",{className:"ml-1 text-text-muted text-xs",children:"hrs"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>x(t),className:"flex items-center gap-1 text-primary hover:text-primary-dark font-bold text-sm bg-primary/10 px-3 py-1 rounded-lg transition-colors",children:[e.jsx(v,{size:16}),"Gestionar Horario"]})})]},t.id))})]})}),!o&&i&&l.length===0&&e.jsx("p",{className:"text-center text-text-muted py-10",children:"No se encontraron usuarios en este servidor."}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto relative border border-border",children:[e.jsx("button",{onClick:()=>x(null),className:"absolute top-4 right-4 text-text-muted hover:text-text-main transition-colors",children:e.jsx(H,{size:24})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 text-text-main",children:["Horario de ",d.nickname]}),e.jsx(G,{serverId:i,userId:d.id,onSave:()=>{f()}})]})]})})]})}export{z as default};
